<!-- pages/task_flow/task_flow.wxml -->
<wxs module="dateTimeSplit" src="../wxs/dateTimeSplit.wxs"></wxs>
<category-selector isActive="{{cateSelectorIsActive}}" curCate="{{category}}" bind:onSelect="handelSelectCate" bind:onCancel="handelCancelSelectCate"/>

<nav-bar title="任务流详情" operation="true">
  <view bind:tap="onSelectCate">改变分类</view>
</nav-bar>
<view class='wrap'>
  <view class='task-flow-info'>
    <view class="task-flow-name">
      {{tf_name}}
      <image wx:if="{{editable}}" src="../../assets/imgs/task_flow/edit.svg" bind:tap="editInfo" />
    </view>
    <view class="else">
      <view class="task-flow-date">{{begin_time}}~{{end_time}}</view>
      <view class="task-flow-leader">负责人:{{leader.nick_name}}</view>
    </view>
  </view>
  <view class='content'>
    <view class="child-task-list">
      <view class="line "></view>
      <view class="item">
        <view class="dot-wrap">
          <view class="dot" style="background-color:#1EA227"></view>
          <view class="date">{{dateTimeSplit.dateSplit(begin_time)}}</view>
          <view class="time">{{dateTimeSplit.timeSplit(begin_time)}}</view>
        </view>
        <view class="task-card">
          <view class="border"></view>
          <view class="task-info">
            <view class="deadline-time" style="margin-left:0">
              <text class="text-bold">任务流截止时间:</text>
              {{end_time}}
            </view>
          </view>
          <view class="task-describe">
            <text class="text-bold">简介:</text>
            {{tf_describe}}
          </view>
          <view class="task-describe" hidden="{{tasks.length}}">
            <text class="text-bold">提示:</text>
            <view>
              您还没有创建子任务,可以点击下方的
              <text class="text-info text-bold">加子任务</text>
              来添加一个子任务
            </view>
          </view>
        </view>
      </view>
      <view wx:for="{{tasks}}" wx:key="{{index}}" class="item" hidden="{{!ready}}">
        <view class="dot-wrap">
          <view class="{{item.renderDot?'dot ok':''}}"></view>
          <view class="date">{{item.renderDot?dateTimeSplit.dateSplit(item.begin_time):''}}</view>
          <view class="time">{{dateTimeSplit.timeSplit(item.begin_time)}}</view>
          <view class="time">评论:{{item.comments.length}} </view>
          <view class="time">图片:{{item.images.length}} </view>
          <view class="dots">
            <view wx:for="{{item.status_map}}" wx:for-item="it" wx:key class="spot" style="background-color:{{it.user_status === 2 ? '#2665AE':'#eee'}}"></view>
          </view>
        </view>
        <view class="task-card" hover-class="hover-effect" bind:tap="taskDetail" data-tid="{{item.id}}">
          <view class="border" hidden="{{!item.is_completed}}" style="{{item.is_completed === 2?'background-color:#DA2037':''}}"></view>
          <view class="task-title">
            <view class="title-wrap">
              <view class="task-name">{{item.t_name}}</view>
              <view class="task-member-count">
                <image src="../../assets/imgs/task_flow/member.svg" />
                {{item.members.length}}
              </view>
            </view>
            <image class="task-status " src="../../assets/imgs/task_flow/check{{item.is_completed && item.is_completed != 2 ?'_ok':''}}.svg" />
          </view>
          <view class="task-info">
            <view>
              执行人:
              <view class="exec-people" wx:for="{{item.members}}" wx:for-item="it" wx:for-index="id" wx:key="id">
                {{it.nick_name}}
              </view>
            </view>
            <view class="deadline-time">截止到{{item.end_time}}</view>
          </view>
          <view class="task-describe">{{item.t_describe}}</view>
        </view>
      </view>
    </view>
  </view>
  <view class='tabbar'>
    <block wx:if="{{is_completed}}" style="">
      <view class='tab-item' bind:tap="checkData">
        <image src='../../assets/imgs/task_flow/curve.svg' class='tab-item-icon'></image>
        <view class='text'>任务曲线</view>
      </view>
      <view class='tab-item' bind:tap="allMembers">
        <image src='../../assets/imgs/task_flow/all_members.svg' class='tab-item-icon'></image>
        <view class='text'>全部人员</view>
      </view>
      <view class='tab-item-important' bind:tap="myTasks">我的任务</view>
    </block>
    <block wx:else>
      <view class='tab-item' bind:tap="addTask" hidden="{{!is_leader}}">
        <image src='../../assets/imgs/task_flow/add.svg' class='tab-item-icon'></image>
        <view class='text'>加子任务</view>
      </view>
      <view class='tab-item' bind:tap="addMember" hidden="{{!is_leader}}">
        <image src='../../assets/imgs/task_flow/add_member.svg' class='tab-item-icon'></image>
        <view class='text'>加新成员</view>
      </view>
      <view class='tab-item' bind:tap="checkData">
        <image src='../../assets/imgs/task_flow/curve.svg' class='tab-item-icon'></image>
        <view class='text'>任务曲线</view>
      </view>
      <view class='tab-item' bind:tap="allMembers">
        <image src='../../assets/imgs/task_flow/all_members.svg' class='tab-item-icon'></image>
        <view class='text'>全部人员</view>
      </view>
      <view class='tab-item-important' bind:tap="myTasks">我的任务</view>
    </block>
  </view>
</view>