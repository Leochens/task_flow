<view class="DrawerPage {{modalName=='viewModal'?'show':''}}">
  <view class=" cu-custom" style="height:{{CustomBar}}px;">
    <view class="cu-bar tabbar fixed custom-bar" style="height:{{CustomBar}}px;padding-top:{{StatusBar}}px;">
      <view class="action text-center" style='width: 100rpx'>
        <button wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo" bindtap='getUserInfo' class='cu-btn icon-my icon bg-green shadow'></button>
        <block wx:else>
          <view class="cu-avatar round" style="background-image:url({{userInfo.avatarUrl}})" data-target="viewModal"></view>
        </block>
      </view>
      <!-- 主菜单 -->
      <block wx:if="{{!isClassify}}">
        <block wx:if="{{curOperation}}">
          <view class="cur-op">
            <view class='icon-cu-image text-white'>
              <text class="pin-left icon-{{curOperation === 2?'roundcheck':'delete'}}fill  margin-0"></text>
            </view>
            <text>{{curOperationText}}</text>
            <view class="back-menu-btn" bindtap='backToMenu'>返回</view>
          </view>
        </block>
        <block wx:else>
          <view class="action {{1==TabCur?'cur':''}}" bindtap='{{!isClassify?"menuTabSelect":""}}' data-id="1">
            <view class='icon-cu-image text-white'>
              <text class="icon-apps  margin-0"></text>
            </view>
          </view>
          <view class="action" bind:tap="_fetchTaskFlows" data-id="2">
            <view class='icon-cu-image text-white'>
              <text class="icon-refresh margin-0"></text>
            </view>
          </view>
          <view class="action " bindtap='{{!isClassify?"menuTabSelect":""}}' data-id="3">
            <view class='icon-cu-image text-white'>
              <text class="icon-delete{{3==TabCur && 3==isFilter?'fill':''}}  margin-0"></text>
            </view>
          </view>
          <view class="action {{4==TabCur?'cur':''}}" data-id="4">
            <view class='icon-cu-image text-white text-bold' bindtap='addNewTaskFlow'>
              <text class='icon-add '></text>
            </view>
          </view>
        </block>
      </block>
      <!-- 分类菜单 -->
      <block wx:else>
        <scroll-view scroll-x class="nav" scroll-with-animation scroll-left="{{scrollLeft}}" style='width:calc(100% - 440rpx)'>
          <view class="cu-item text-white {{index==TabCur?'text-bold cur':''}}" wx:for="{{categories}}" wx:key bindtap='{{isClassify?"classTabSelect":""}}' data-id="{{index}}">
            {{index>0?item:"返回"}}
          </view>
        </scroll-view>
      </block>
    </view>
  </view>
</view>
<view class='task-flows' style='margin-top:{{CustomBar}}px;'>
  <view class="UCenter-bg bg-main">
    <image class="gif-wave" mode="scaleToFill" src="http://mokis.top/wave.gif"></image>
  </view>
  <view wx:if="{{currentCategoryTaskFlowList.length}}">
    <form-id>
      <task-flow-card bind:onDeleteTaskFlow="onDeleteTaskFlow" tfCardType="{{tfCardType}}" wx:if="{{showCom}}" wx:for="{{currentCategoryTaskFlowList}}" wx:key="{{key}}" taskFlowData="{{item}}" bindtap='toTaskFlowDetail' data-tfid='{{item.id}}' />
    </form-id>
  </view>
  <view wx:else>
    <view wx:if="{{filterTaskFlowList.length || taskFlowList.length}}">
      <view class="cu-bar bg-white">
        <view class="action">
          <view class="cu-tag line-main">
            总数:{{filterTaskFlowList.length?filterTaskFlowList.length:taskFlowList.length+pinTopTaskFlowList.length}}
          </view>
        </view>
        <view style="display:flex" wx:if="{{filter}}">
          <view class="cu-tag line-{{item.active?'orange':'grey'}}" wx:for="{{filterItems}}" wx:key data-id="{{index}}" bind:tap="onFilter">
            {{item.which}}
          </view>
        </view>
        <view class="action">
          <view class="cu-capsule round">
            <view class="cu-tag">
              <view class="cu-icon-image text-xl">
                <view class="icon-search" bind:tap="toSearch"></view>
              </view>
            </view>
            <view class="cu-tag {{filter?'bg-main':''}}">
              <view class="cu-icon-image text-xl">
                <view class="icon-filter" bind:tap="toggleFilter"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
      <form-id wx:if="{{!filter && pinTopTaskFlowList.length}}">
        <view class="cu-bar">
          <view class="action">
            <view class="icon-title text-main"></view>
            <text class="text-grey">置顶任务流</text>
          </view>
          <view class="action" bind:tap="toggleFoldPinTaskFlow">
            <view class="cu-tag bg-gray round margin-right-xs">
              <view class="icon-{{isPinTaskFlowFold?'un':''}}fold"></view>
            </view>
          </view>
        </view>
        <task-flow-card bind:onDeleteTaskFlow="onDeleteTaskFlow" tfCardType="{{tfCardType}}" simplify="{{isPinTaskFlowFold}}" bind:longpress="cancelPinTopTf" bind:touchstart="handleTouchStart" bind:touchend="handleTouchEnd" wx:if="{{showCom}}" wx:for="{{pinTopTaskFlowList}}" wx:key="{{key}}" taskFlowData="{{item}}" bindtap='toTaskFlowDetail' data-tfid='{{item.id}}' />
      </form-id>
      <form-id>
        <view wx:if="{{pinTopTaskFlowList.length}}" class="cu-bar">
          <view class="action">
            <view class="icon-title text-main"></view>
            <text class="text-grey">{{filter?'筛选任务流':'所有任务流'}}</text>
          </view>
          <view class="action" bind:tap="toggleFoldTaskFlow">
            <view class="cu-tag bg-gray round margin-right-xs">
              <view class="icon-{{isTaskFlowFold?'un':''}}fold"></view>
            </view>
          </view>
        </view>
        <task-flow-card bind:onDeleteTaskFlow="onDeleteTaskFlow" tfCardType="{{tfCardType}}" simplify="{{isTaskFlowFold}}" bind:longpress="pinTopTf" bind:touchstart="handleTouchStart" bind:touchend="handleTouchEnd" wx:if="{{showCom}}" wx:for="{{filterTaskFlowList.length?filterTaskFlowList:taskFlowList}}" wx:key="{{key}}" taskFlowData="{{item}}" bindtap='toTaskFlowDetail' data-tfid='{{item.id}}' />
      </form-id>
    </view>
    <view wx:else>
      <form-id>
        <view class="empty-list">还没有任务流呢,快点击上方的加号添加吧！</view>
      </form-id>
    </view>
  </view>
</view>
<view class="cu-modal {{showAuthModal?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">授权</view>
    </view>
    <view class="padding-xl">
      <view class='text-grey'>申请获得您的以下权限</view>
      <view class='text-grey text-sm'>获得您的公开信息(昵称，头像等)</view>
      
      <button class="cu-btn bg-main margin-top-xl" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
        确认授权
      </button>
    </view>
  </view>
</view>