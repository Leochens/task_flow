<!-- pages/task/task.wxml -->
<wxs module="memberStatus" src="../wxs/memberStatus.wxs"></wxs>

<nav-bar isBack="{{true}}">
  <view slot="backText">返回</view>
  <view slot="content">子任务详情</view>
</nav-bar>
<view class="task-wrap">
    <view class="title-wrap">
        <view class="title">
            <view>
                {{task.t_name}}
                <!-- <image class="edit" wx:if="{{editable}}" src="../../assets/imgs/task_flow/edit.svg" bind:tap="editInfo" /> -->
                <text wx:if="{{editable}}" class="icon-edit text-main" bind:tap="editInfo"></text>
            </view>
            <view>
                <view class="icon-more text-main" bind:tap="toTaskSettings"></view>
            </view>
        </view>
        <view class="deadline">开始:{{task.begin_time}}</view>
    </view>
    <view class="main">
        <view class="line" style="border-color:{{task.is_completed === 1? '#2665AE':task.is_completed === 0 ?'':'red'}}">
            <view class="dot" style="background-color:{{task.is_completed === 1? '#2665AE':task.is_completed === 0 ?'':'red'}}"></view>
        </view>
        <swiper class="swiper" indicator-dots="{{false}}" autoplay="{{false}}">
            <swiper-item class="content">
                <view class="begin-time">截止:{{task.end_time}}</view>
                <view class="card">
                    <view class="task-describe">
                        <view class="describe-wrap">
                            <label>内容:</label>
                            <view class="status">
                                <image class="is_completed" src="../../assets/imgs/task_flow/check{{task.is_completed === 1 ?'_ok':''}}.svg" />
                                {{task.is_completed === 1? '已完成':task.is_completed === 0 ? '进行中' : '已逾期'}}
                            </view>
                        </view>
                        <view class="describe-content">{{task.t_describe}}</view>
                    </view>
                    <view class="task-exec-people">
                        <label>执行人:</label>
                        <view class="table">
                            <view class="tr">
                                <view class="th">人员</view>
                                <view class="th">状态</view>
                            </view>
                            <view class="tr" wx:for="{{task.members}}" wx:key="">
                                <view class="td">{{item.nick_name}}</view>
                                <view class="td {{memberStatus(item,task.status_map)?'':'text-red'}}">
                                    {{memberStatus(item,task.status_map)}}
                                </view>
                            </view>
                        </view>
                    </view>
                    <view>
                        <view class="images" class="grid col-3 grid-square flex-sub">
                            <view class="bg-img" wx:for="{{imgs}}" wx:key>
                                <image src="{{item.url}}" mode="aspectFill" bind:tap="previewImg" data-id="{{index}}" />
                                <view class="cu-tag bg-grey light">{{item.nick_name}}</view>
                            </view>
                            <view bind:tap="bindChooiceImage" wx:if="{{task.is_completed != 1}}" class="solids">
                                <text class="icon-cameraadd"></text>
                            </view>
                        </view>
                    </view>
                </view>
                <view class="tip-btn">左滑进入留言区</view>
            </swiper-item>
            <swiper-item class="content">
                <view class="begin-time">2019-2-1 14:35:44</view>
                <view class="cu-chat">
                    <view wx:if="{{task.comments.length}}">
                        <view class="cu-item" wx:for="{{task.comments}}" wx:key>
                            <view class="cu-avatar radius" style="background-image:url({{item.avatar_url}});"></view>
                            <view class="main">
                                <view class="date">{{item.nick_name}} {{item.create_time}}</view>
                                <view class="content shadow">
                                    <text>{{item.content}}</text>
                                </view>
                            </view>
                        </view>
                    </view>
                    <view wx:else class="empty-comment">没有评论,快来添加一条吧</view>
                </view>
                <form wx:if="{{task.is_completed != 1}}" class="send-comment" bindsubmit="commentSubmit">
                    <view class="input-comment">
                        <input name="comment" value="{{content}}" />
                    </view>
                    <button form-type="submit" class="send-btn">留言</button>
                </form>
                <view class="tip-btn">右滑进入详情页</view>
            </swiper-item>
        </swiper>
    </view>
</view>